<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Splitter Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .upload-area { border: 2px dashed #2b579a; padding: 20px; text-align: center; margin: 20px 0; }
        #preview { margin: 20px 0; border: 1px solid #ddd; min-height: 300px; }
        .btn { background: #2b579a; color: white; border: none; padding: 10px 20px; cursor: pointer; }
        .page-thumb { display: inline-block; margin: 5px; border: 1px solid #ccc; }
        .progress { margin: 10px 0; color: green; font-weight: bold; }
    </style>
</head>
<body>
    <h1>PDF Splitter Tool</h1>
    <div class="upload-area" id="drop-area">
        <p>Drag & drop a PDF file here or</p>
        <input type="file" id="file-input" accept=".pdf">
    </div>
    
    <div id="preview-section" style="display: none;">
        <h3>Select Pages to Split:</h3>
        <div id="page-thumbnails"></div>
        <div>
            <label>From Page: <input type="number" id="start-page" min="1" value="1"></label>
            <label>To Page: <input type="number" id="end-page" min="1" value="1"></label>
        </div>
        <button class="btn" id="split-btn">Split & Download</button>
    </div>
    <div id="progress" class="progress"></div>

    <script>
        // Initialize PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';

        let pdfDoc = null;
        const fileInput = document.getElementById('file-input');
        const dropArea = document.getElementById('drop-area');
        const previewSection = document.getElementById('preview-section');
        const pageThumbnails = document.getElementById('page-thumbnails');
        const progress = document.getElementById('progress');

        // Handle file selection
        fileInput.addEventListener('change', async (e) => {
            if (e.target.files.length === 0) return;
            await loadPDF(e.target.files[0]);
        });

        // Drag and drop handlers
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        dropArea.addEventListener('drop', async (e) => {
            const dt = e.dataTransfer;
            if (dt.files.length === 0) return;
            await loadPDF(dt.files[0]);
        });

        // Load PDF and render thumbnails
        async function loadPDF(file) {
            progress.textContent = "Loading PDF...";
            const reader = new FileReader();
            
            reader.onload = async function() {
                try {
                    const typedArray = new Uint8Array(this.result);
                    pdfDoc = await pdfjsLib.getDocument(typedArray).promise;
                    
                    // Render thumbnails
                    pageThumbnails.innerHTML = '';
                    for (let i = 1; i <= pdfDoc.numPages; i++) {
                        const page = await pdfDoc.getPage(i);
                        const viewport = page.getViewport({ scale: 0.5 });
                        
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        canvas.className = 'page-thumb';
                        
                        await page.render({
                            canvasContext: context,
                            viewport: viewport
                        }).promise;
                        
                        pageThumbnails.appendChild(canvas);
                    }
                    
                    document.getElementById('end-page').value = pdfDoc.numPages;
                    previewSection.style.display = 'block';
                    progress.textContent = `Loaded ${pdfDoc.numPages} pages`;
                } catch (err) {
                    progress.textContent = "Error: " + err.message;
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        // Split and download PDF
        document.getElementById('split-btn').addEventListener('click', async () => {
            if (!pdfDoc) return;
            
            const startPage = parseInt(document.getElementById('start-page').value);
            const endPage = parseInt(document.getElementById('end-page').value);
            
            if (startPage < 1 || endPage > pdfDoc.numPages || startPage > endPage) {
                progress.textContent = "Invalid page range!";
                return;
            }
            
            progress.textContent = "Splitting PDF...";
            
            try {
                // Create a new PDF with selected pages
                const { PDFDocument } = PDFLib;
                const newPdf = await PDFDocument.create();
                
                // Load the original PDF
                const originalBytes = await pdfDoc.getData();
                const originalPdf = await PDFDocument.load(originalBytes);
                
                // Copy selected pages
                const pages = await newPdf.copyPages(originalPdf, 
                    Array.from({length: endPage - startPage + 1}, (_, i) => startPage - 1 + i)
                );
                
                pages.forEach(page => newPdf.addPage(page));
                
                // Save and download
                const newPdfBytes = await newPdf.save();
                const blob = new Blob([newPdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `split_pages_${startPage}-${endPage}.pdf`;
                a.click();
                
                progress.textContent = `Downloaded pages ${startPage}-${endPage}`;
            } catch (err) {
                progress.textContent = "Error: " + err.message;
            }
        });
    </script>
</body>
</html>
